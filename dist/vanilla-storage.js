(function(){(function(){"use strict";var e={ensureCallback:function(e){return typeof e!="function"?function(){}:e},parseKey:function(e){return e=e.replace(/\//g,""),e=e.replace(/[:]/g,""),e=e.replace(/[.]/g,""),e}};typeof define=="function"&&define.amd?define("storageHelpers",[],function(){return e}):window.storageHelpers=e})(),function(){"use strict";function e(e){var t=e.ensureCallback,n=e.parseKey,r=function(){if(!this.isValid())return!1;this.db=null,this.TABLE_NAME="vanilla_store",this.DATABASE_NAME="vanilladb",this.DATABASE_VERSION="1.0.0",this.DATABASE_SIZE=5242880};return r.prototype={isValid:function(){return typeof window.openDatabase=="function"},init:function(e){e=t(e);try{this.isValid()&&(this.db=window.openDatabase(this.DATABASE_NAME,this.DATABASE_VERSION,this.DATABASE_NAME,this.DATABASE_SIZE))}catch(n){console.log("ERROR opening websql database",n)}if(!this.db)return e("No db available");var r="CREATE TABLE IF NOT EXISTS "+this.TABLE_NAME+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)";this.db.transaction(function(e){e.executeSql(r,[])},function(n){return e(n),!0},function(){e(null)})},get:function(e,r){r=t(r),e=n(e);if(!this.db)return r("No db available");var i="SELECT id, value FROM "+this.TABLE_NAME+" WHERE id = ?";this.db.transaction(function(t){t.executeSql(i,[e],function(n,i){var s=null;if(i.rows.length>0){s=i.rows.item(0).value;try{s=JSON.parse(s)}catch(o){return r("JSON Parse error: "+s)}}s?r(null,s):r("No data found for key: "+e)})},function(t){return r(t),!0})},save:function(e,r,i){i=t(i),e=n(e);var s;try{s=JSON.stringify(r)}catch(o){return i("JSON Parse error: "+r)}if(!this.db)return i("No db available");var u="INSERT OR REPLACE INTO "+this.TABLE_NAME+" (id, value, timestamp) VALUES (?,?,?)",a=[e,s,(new Date).getTime()];this.db.transaction(function(e){e.executeSql(u,a,function(){i(null,r)})},function(t){return i(t),!0})},"delete":function(e,r){if(!this.db)return r("No db available");r=t(r),e=n(e);var i="DELETE FROM "+this.TABLE_NAME+" WHERE id = ?";this.db.transaction(function(t){t.executeSql(i,[e],function(){r(null)})},function(t){return r(t),!0})},nuke:function(e){e=t(e);var n="DELETE FROM "+this.TABLE_NAME;this.db.transaction(function(t){t.executeSql(n,[],function(){e(null)})},function(n){return e(n),!0})}},r}typeof define=="function"&&define.amd?define("WebSQLStorage",["storageHelpers"],function(t){return e(t)}):window.WebSQLStorage=e(window.storageHelpers)}(),function(){"use strict";function t(t){var n=t.ensureCallback,r=t.parseKey,i=function(){if(!this.isValid())return!1;this.DATABASE_NAME="vanilla_idb",this.DATABASE_VERSION=1,this.db=null,this.KEYS=[]};return i.prototype={isValid:function(){return!!e&&"indexedDB"in window},setKeys:function(e){this.KEYS=e},init:function(e){e=n(e);var t=this,i=window.indexedDB.open(this.DATABASE_NAME,this.DATABASE_VERSION);i.onupgradeneeded=function(e){var n=e.target.result,i;for(i in t.KEYS){var s=r(t.KEYS[i]);n.objectStoreNames.contains(s)&&n.deleteObjectStore(s);var o=n.createObjectStore(s,{keyPath:s,autoIncrement:!1});console.log("---indexed-db--- created store: "+s,o)}},i.onsuccess=function(n){t.db=n.target.result,e(null)},i.onerror=function(t){e(t.target.error)}},get:function(e,t){t=n(t),e=r(e);var i,s;try{i=this.db.transaction([e],"readonly"),s=i.objectStore(e);var o=s.get(e);o.onsuccess=function(n){var r=n.target.result,i=!!r,s=i===!1;return s?t("No data found for key: "+e):t(null,r)},o.onerror=function(e){t(e)}}catch(u){return t(u)}},save:function(e,t,i){i=n(i),e=r(e);var s,o,u;try{s=this.db.transaction([e],"readwrite"),o=s.objectStore(e),t[e]=e;try{u=o.put(t),u.onsuccess=function(){i(null,t)},u.onerror=function(e){i(e)}}catch(a){return console.log(e,"IDB Error put: ",a," data: ",t),i(a)}}catch(a){return console.log(e,a),i(a)}},"delete":function(e,t){t=n(t),e=r(e);try{var i=this.db.transaction([e],"readwrite"),s=i.objectStore(e);try{var o=s.delete(e);o.onsuccess=function(){t(null)},o.onerror=function(e){t(e)}}catch(u){return log("IDB Error delete: ",u," key ",e),t(u)}}catch(u){return t(u)}},nuke:function(e){function i(n){try{t.delete(t.KEYS[n],function(){if(--r===0)return e(null);i(n++)})}catch(s){log("IDB ERROR",s);if(--r===0)return e(s);i(n++)}}e=n(e);var t=this,r=this.KEYS.length;i(0)}},i}var e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;typeof define=="function"&&define.amd?define("IDBStorage",["storageHelpers"],function(e){return t(e)}):window.IDBStorage=t(window.storageHelpers)}(),function(){"use strict";function e(e,t,n){var r=n.ensureCallback,i={"indexeddb-storage":new t,"websql-storage":new e},s=function(e,t){var n=this;t=r(t),this.adapter=null;if(e&&e.adapterID)this.adapter=i[e.adapterID],this.adapterID=e.adapterID;else for(var s in i){var o=typeof i[s].isValid=="function";if(o&&i[s].isValid()){this.adapter=i[s],this.adapterID=s;break}}if(typeof window.cordova!="undefined"){var u="websql-storage";this.adapter=i[u],this.adapterID=u}if(!this.adapter||!this.adapter.isValid()){var a="Storage: No valid adapter: "+this.adapterID;return t.call(n,a)}typeof this.adapter.setKeys=="function"&&e&&e.keys&&this.adapter.setKeys(e.keys),this.adapter.init(function(e){e&&t.call(n,e),t.call(n,null)})};return s.prototype={isValid:function(){return this.adapter.isValid()},get:function(e,t){this.adapter.get(e,t)},save:function(e,t,n){this.adapter.save(e,t,n)},"delete":function(e,t){this.adapter.delete(e,t)},nuke:function(e){this.adapter.nuke(e)}},s.isValid=function(e){var t=i[e];return t?t.isValid():!1},s}typeof define=="function"&&define.amd?define("VanillaStorage",["WebSQLStorage","IDBStorage","storageHelpers"],function(t,n,r){var i=e(t,n,r);return i}):window.VanillaStorage=e(window.WebSQLStorage,window.IDBStorage,window.storageHelpers)}()})();